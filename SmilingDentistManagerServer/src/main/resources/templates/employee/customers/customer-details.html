<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/common-head :: common-head('Customer')}"></th:block>
</head>
<body>
    
    <div th:replace="~{fragments/common-top-page :: common-top-page}"></div>
   
    <!-- Sidebar and nav for mobile screens -->
    <div th:replace="~{fragments/menu-dashboard-employee :: side-dashboard-mobile}"></div>

	<div class="d-flex">

        <!-- Sidebar for medium and larger screens -->
        <div th:insert="~{fragments/menu-dashboard-employee :: side-dashboard}" class="col-md-3 col-lg-2" ></div>

    
        <!-- Main Content -->
        <main class="content col-md-9 ms-sm-auto col-lg-10 col-12 px-md-4">
            
            <!-- here the page content -->
            <div class="row sdm-work-area-scollable">

                <!-- Customer nav -->
                <!-- <nav th:replace="~{fragments/customers/customers-nav :: customers-nav}"></nav> -->

                <!-- Customer Personal Datas -->

                <nav th:replace="~{fragments/customers/customer-details/customer-details-navs
                    :: customer-info( ${joinCustomer.customerDTO} )}">
                </nav>

                <div class="p-3">


                    <div class=" ">
                        <span class="fw-bold" th:text="#{labelEMail}"></span>
                        <span th:text="' ' + ${joinCustomer.customerDTO.eMail} + ' '"></span>
                        &emsp; <!-- 4 spazi ; &ensp; 2 spazi -->
                        <span class="fw-bold" th:text="#{labelTaxIdCode}"></span>
                        <span th:text=" ' ' + ${joinCustomer.customerDTO.taxIdCode} + ' '"></span>
                        &emsp; <!-- 4 spazi ; &ensp; 2 spazi -->
                        <span class="fw-bold" th:text="#{labelPhoneNumber}"></span>
                        <span th:text=" ' ' + ${joinCustomer.customerDTO.phoneNumber} + ' '"></span>
                        &emsp; <!-- 4 spazi ; &ensp; 2 spazi -->
                        <span class="fw-bold" th:text="#{labelPhoneNumber2}"></span>
                        <span th:text=" ' ' + ${joinCustomer.customerDTO.phoneNumber2} + ' '"></span>
                    </div>
    
                    <div class="">
                        <span class="fw-bold" th:text="#{labelBirthplace}"></span>
                        <span th:text=" ' ' + ${joinCustomer.customerDTO.birthCity} + ' (' + ${joinCustomer.customerDTO.birthCityProvince} + ') '"></span>
                        &emsp; <!-- 4 spazi ; &ensp; 2 spazi -->
                        <span class="fw-bold" th:text="#{labelBirthDate}"></span>
                        <span   th:with="dateFormat=#{formPlaceholderDate}"
                                th:text=" ' ' + ${ #temporals.format ( joinCustomer.customerDTO.birthDate, dateFormat) }"></span>
                        &emsp; <!-- 4 spazi ; &ensp; 2 spazi -->
                        
                        <span class="fw-bold" th:text="#{labelPlaceOfResidence}"> </span>

                        <span th:text="' ' + #{labelStreet} + ' ' + ${joinCustomer.customerDTO.residenceStreet} + ' ' 
                                        + ${joinCustomer.customerDTO.houseNumber} + ' ' + ${joinCustomer.customerDTO.residenceCity} + ' ' 
                                        + ${joinCustomer.customerDTO.residenceCityCap} + ' ' + ${joinCustomer.customerDTO.residenceProvince}">
                        </span>
                        &emsp; <!-- 4 spazi ; &ensp; 2 spazi -->
                    </div>

                    <div class="">
                        <span class="fw-bold" th:text="#{labelPermissions}"> </span>
                        <span th:text="#{ ${joinCustomer.customerDTO.permission} }"></span>
                    </div>
    

                </div>

                <!-- Medical History -->

                <nav th:replace="~{fragments/customers/customer-details/customer-details-navs
                                    :: customer-medical-histories }">
                </nav> 

                <div class="row">

                    <div class="sdm-table-scrollable table-responsive mt-3">
                        <table class="table table-striped table-bordered text-center mt-3"
                                th:each="entry : ${ joinCustomer.mapByTypeJoinMedicalHistoriesDTO }">
    
                                <thead>
                                    <!-- Medical History Type -->
                                    <tr  >
                                        <th colspan="5" class="sdm-table-header-bg" >
                                            <span th:text="${entry.key}">Medical History Type</span>
                                        </th>
                                    </tr>
                                    <!-- Medical History table header -->
                                    <tr>
                                        <th></th>
                                        <th th:text="#{tableHeaderCategory}">Category</th>
                                        <th th:text="#{tableHeaderName}">Name</th>
                                        <th th:text="#{tableHeaderDescription}">Description</th>  
                                        <th>Notes</th>                                  
                                    </tr>
                                </thead>
    
                                <tbody>
                                    <tr th:each="joinMedicalHistory : ${ entry.value }">
    
                                        <td class="text-center align-middle ">
                                            <button th:id="'btnDeleteHasMedicalHistory' + ${ joinMedicalHistory.hasMedicalHistoryDTO.id }"
                                                    class="btn btn-danger" 
                                                    th:text="#{btnDelete}">
                                                Delete
                                            </button>
                                            <div class="d-inline-block" 
                                                    th:insert="~{fragments/customers/customer-details/medical-histories/put-has-medical-history-modal
                                                        :: put-has-medical-history-modal( 
                                                            ${ joinMedicalHistory.hasMedicalHistoryDTO.idCustomer },
                                                            ${ joinMedicalHistory}  ) }">
                                                Edit
                                            </div>
                                        </td>
    
                                        <td>
                                            <span th:text="${joinMedicalHistory.medicalHistoryDTO.category}"></span>
                                        </td>
    
                                        <td>
                                            <span th:text="${joinMedicalHistory.medicalHistoryDTO.name}"></span>
                                        </td>
    
                                        <td>
                                            <span th:text="${joinMedicalHistory.medicalHistoryDTO.description}"></span>
                                        </td>

                                        <td>
                                            <span th:text="${joinMedicalHistory.hasMedicalHistoryDTO.notes}"></span>
                                        </td>
    
                                    </tr>
                                </tbody>
    
                        </table>
                    </div>

                </div>
                
                <!-- Appointments -->
                
                <nav th:replace="~{fragments/customers/customer-details/customer-details-navs
                                    :: customer-appointments( ${ joinCustomer.customerDTO.id } ) }">
                </nav> 
                
                <div class="row">

                    <div class="sdm-calendar-table-reponsive table-responsive mt-3">
                        <table class="table table-striped table-bordered text-center">
                            <thead>
                                <tr>
                                    
                                    <th></th>
                                    <th th:text="#{tableHeaderDate}">Date</th>
                                    <th th:text="#{tableHeaderDoctor}">Doctor</th>
                                    <th th:text="#{tableHeaderTreatment}">Treatment</th>
                                    <th th:text="#{tableHeaderPayment}">Payment</th>
                                    <th th:text="#{tableHeaderInvoiceNumber}">Invoice Number</th>
                                    <th th:text="#{tableHeaderNotes}">Notes</th>
                                </tr>
                            </thead>
    
                            <tbody>
                                <tr th:each="appointment : ${ joinCustomer.joinAppointmentsDTO }">
                                    
                                    <td class="d-flex justify-content-center">
                                        
                                        <button th:id="'btnDeleteAppointment' + ${appointment.appointmentDTO.id}"
                                            class="btn btn-danger sdm-onclick-reload me-2"
                                            th:text="#{btnDelete}">
                                            
                                        </button>

                                        <div class="d-inline-block"
                                             th:insert="~{fragments/customers/customer-details/appointments/put-appointment-modal
                                                            :: put-appointment-modal( ${ joinCustomer.customerDTO.id }, ${appointment} )}">
                                        </div>

                                    </td>
                                    <td 
                                        th:with="dateFormat=#{formPlaceholderDate}"
                                        th:text="${ #temporals.format( appointment.appointmentDTO.date, dateFormat )}" >
                                    </td>
                                    <td>
                                        <span th:text="${appointment.doctorDTO.name}"></span> <span th:text="${appointment.doctorDTO.surname}"></span>
                                    </td>
                                    <td>
                                        <span th:text="${appointment.treatmentDTO.name}"></span>
                                    </td>
                                    <td>
                                        <span th:text="${appointment.appointmentDTO.payment}"></span> 
                                    </td>
                                    <td>
                                        <span th:text="${appointment.appointmentDTO.invoiceNumber}"></span> 
                                    </td>
                                    <td>
                                        <span th:text="${appointment.appointmentDTO.notes}"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div> <!-- End Table-responsive -->
    
    

                </div>

            </div>
        </main>
    </div> <!-- end d-flex -->


    <!-- for put, add, delete  buttons -->
    <div th:replace="~{fragments/customers/customer-details/requires-customer-details 
                        :: requires-customer-details}"></div>


    <div th:replace="~{fragments/common-bottom-page :: common-bottom-page}"></div>           

</body>
</html>